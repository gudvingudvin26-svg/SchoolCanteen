<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .balance-card {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .balance-amount {
            font-size: 3rem;
            font-weight: bold;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        .info-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        .info-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #343a40;
        }
        .reviews-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .review-item:last-child {
            border-bottom: none;
        }
        .rating-stars {
            color: #ffc107;
            font-size: 1.2rem;
        }
        .pref-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .pref-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        .action-btn {
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            color: white;
        }
        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            color: white;
        }
        .btn-menu { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-orders { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-subscriptions { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); }
        .btn-reviews { background: linear-gradient(135deg, #17a2b8 0%, #6610f2 100%); }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container">
            <a class="navbar-brand navbar-brand-custom" href="{% url 'home' %}">üçΩÔ∏è –®–∫–æ–ª—å–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è</a>
            <div class="navbar-nav ms-auto">
                <span class="nav-link text-white">{{ user.first_name }} {{ user.last_name }}</span>
                <a class="nav-link" href="{% url 'home' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a class="nav-link" href="{% url 'logout' %}">üö™ –í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}success{% endif %} alert-custom">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}


        <div class="balance-card">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-1">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                    <div class="balance-amount">{{ user.balance }} ‚ÇΩ</div>
                </div>
                <div class="col-md-6">
                    <form method="post" action="{% url 'add_balance' %}">
                        {% csrf_token %}
                        <div class="input-group input-group-lg">
                            <input type="number" name="amount" class="form-control"
                                   placeholder="–°—É–º–º–∞" min="1" max="100000" step="1" value="100" required>
                            <button type="submit" class="btn btn-light" style="background: white; color: #28a745; font-weight: bold;">
                                –ü–æ–ø–æ–ª–Ω–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ total_orders|default:"0" }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ completed_orders|default:"0" }}</div>
                <div class="stat-label">–ü–æ–ª—É—á–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ pending_orders|default:"0" }}</div>
                <div class="stat-label">–û–∂–∏–¥–∞—é—Ç</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_reviews|default:"0" }}</div>
                <div class="stat-label">–û—Ç–∑—ã–≤–æ–≤</div>
            </div>
        </div>
        <div class="info-grid">
            <div class="info-item">
                <div class="stat-label">–ò–º—è</div>
                <div class="info-value">{{ user.first_name }} {{ user.last_name }}</div>
            </div>
            <div class="info-item">
                <div class="stat-label">–ö–ª–∞—Å—Å</div>
                <div class="info-value">{{ user.class_number|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
            </div>
            <div class="info-item">
                <div class="stat-label">Email</div>
                <div class="info-value">{{ user.email }}</div>
            </div>
            <div class="info-item">
                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                <div class="info-value">
                    {% if avg_rating %}
                        {{ avg_rating|floatformat:1 }} ‚òÖ
                    {% else %}
                        –ù–µ—Ç –æ—Ü–µ–Ω–æ–∫
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="reviews-section">
            <div class="pref-title">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–∑—ã–≤—ã</div>
            {% if recent_reviews %}
                {% for review in recent_reviews %}
                    <div class="review-item">
                        <div class="d-flex justify-content-between">
                            <strong>{{ review.dish.name }}</strong>
                            <div class="rating-stars">
                                {% for i in "12345"|make_list %}
                                    {% if forloop.counter <= review.rating %}‚òÖ{% else %}‚òÜ{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <p class="mt-2 mb-1">{{ review.comment|truncatechars:100 }}</p>
                        <small class="text-muted">{{ review.created_at|date:"d.m.Y" }}</small>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">–í—ã –µ—â–µ –Ω–µ –æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞</p>
            {% endif %}
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="pref-section">
                    <div class="pref-title">‚ö†Ô∏è –ê–ª–ª–µ—Ä–≥–µ–Ω—ã</div>
                    <form method="post" action="{% url 'update_allergies' %}">
                        {% csrf_token %}
                        <div class="checkbox-grid">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="allergies" value="–ì–ª—é—Ç–µ–Ω">
                                <label class="form-check-label">–ì–ª—é—Ç–µ–Ω</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="allergies" value="–õ–∞–∫—Ç–æ–∑–∞">
                                <label class="form-check-label">–õ–∞–∫—Ç–æ–∑–∞</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="allergies" value="–û—Ä–µ—Ö–∏">
                                <label class="form-check-label">–û—Ä–µ—Ö–∏</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="allergies" value="–Ø–π—Ü–∞">
                                <label class="form-check-label">–Ø–π—Ü–∞</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>
                    <div class="mt-3">
                        {% for allergy in user.allergies.all %}
                            <span class="allergen-tag">{{ allergy.name }}</span>
                        {% empty %}
                            <span class="text-muted">–ù–µ—Ç –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤</span>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="pref-section">
                    <div class="pref-title">‚≠ê –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</div>
                    <form method="post" action="{% url 'update_preferences' %}">
                        {% csrf_token %}
                        <div class="checkbox-grid">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="preferences" value="–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ">
                                <label class="form-check-label">–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="preferences" value="–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞">
                                <label class="form-check-label">–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="preferences" value="–ë–µ–∑–≥–ª—é—Ç–µ–Ω–æ–≤–æ–µ">
                                <label class="form-check-label">–ë–µ–∑–≥–ª—é—Ç–µ–Ω–æ–≤–æ–µ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="preferences" value="–ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ">
                                <label class="form-check-label">–ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>
                    <div class="mt-3">
                        {% for pref in user.preferences.all %}
                            <span class="badge bg-info">{{ pref.name }}</span>
                        {% empty %}
                            <span class="text-muted">–ù–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

<div class="action-buttons">
    <a href="{% url 'menu_list' %}" class="action-btn btn-menu">üìÖ –ú–µ–Ω—é</a>
    <a href="{% url 'order_history' %}" class="action-btn btn-orders">üìã –ó–∞–∫–∞–∑—ã</a>
    <a href="{% url 'subscription_list' %}" class="action-btn btn-subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a>
    <a href="{% url 'notification_list' %}" class="action-btn btn-reviews">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
</div>
    </div>

    <footer class="footer-custom mt-5">
        <div class="container">
            <p class="mb-0">¬© 2026 –®–∫–æ–ª—å–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è. –ö–æ–º–∞–Ω–¥–∞ 875.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>